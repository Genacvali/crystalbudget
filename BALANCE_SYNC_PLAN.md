# План: Фактический баланс из ZenMoney

## Что делаем:

### 1. Синхронизация балансов счетов
- ✅ Создана таблица `zenmoney_accounts` с полями:
  - `balance` - фактический баланс из ZenMoney
  - `calculated_balance` - расчетный баланс по транзакциям CrystalBudget
  - `balance_diff` - разница между фактическим и расчетным
  - `last_balance_check_at` - когда последний раз проверяли

### 2. Обновление главного экрана
**Было:**
- 💰 Общий баланс: [сумма всех транзакций]

**Станет:**
- 💎 Фактический баланс: [сумма из ZenMoney счетов]
- Если есть расхождение > 1%: показать индикатор ⚠️

### 3. Автоматическая синхронизация балансов
- Каждую минуту (вместе с транзакциями) обновляем балансы счетов
- Сохраняем в `zenmoney_accounts`
- Подсчитываем общий фактический баланс

### 4. Edge Function для проверки балансов
- ✅ Создана `zenmoney-balance-check`
- Сравнивает фактический vs расчетный баланс
- Возвращает отчет с расхождениями

## Преимущества:

1. **Точность** - видим реальный баланс из банка
2. **Контроль** - если есть расхождение, можем найти пропущенные транзакции
3. **Доверие** - данные синхронизируются с банком автоматически

## Следующие шаги:

1. ✅ Миграция БД создана
2. ✅ Edge Function для проверки баланса создана  
3. 🔄 Обновить zenmoney-sync для сохранения балансов
4. 🔄 Обновить главный экран для показа фактического баланса
5. 🔄 Добавить индикатор расхождений

## UI изменения:

```
Было:
┌─────────────────────┐
│ 💰 Общий баланс     │
│ 125 000 ₽          │
└─────────────────────┘

Станет:
┌─────────────────────┐
│ 💎 Фактический      │
│ 125 340 ₽          │
│ 🔄 Обновлено 14:30  │
└─────────────────────┘

Если есть расхождение:
┌─────────────────────┐
│ 💎 Фактический      │
│ 125 340 ₽          │
│ ⚠️ Расчетный: 125k  │
│ (разница: +340₽)    │
└─────────────────────┘
```
